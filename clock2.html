<!doctype html>
<html lang="zh-Hant">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flip Clock Single-Face</title>
	<style>
		:root{
			--bg:#0f1115; --fg:#e7eaf0; --muted:#8a90a2; --accent:#7c9cff;
			--radius:14px; --font: ui-sans-serif, system-ui, -apple-system, "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
			--scale:1;
		}
		@media (prefers-color-scheme: light){
			:root{ --bg:#ffffff; --fg:#1f2430; --muted:#6a6f80; --accent:#3b5bdb; }
		}
		html,body{ height:100%; margin:0; background:transparent; }
		.widget{ width:100%; height:100%; display:flex; align-items:center; justify-content:center; padding:16px; box-sizing:border-box; }
		.card{
			background:var(--bg); color:var(--fg); border-radius:var(--radius);
			box-shadow: 0 6px 24px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.05);
			padding: clamp(14px, 3.6vw, 24px);
			display:flex; flex-direction:column; gap: clamp(8px, 2vw, 12px);
			transform: scale(var(--scale)); transform-origin:center;
			min-width: 280px; max-width: 720px;
		}
		.card.bordered{ box-shadow: inset 0 0 0 1px rgba(124,156,255,.28), 0 6px 24px rgba(0,0,0,.22); }
		.row{ display:flex; align-items:stretch; justify-content:center; gap: clamp(8px, 2vw, 12px); }
		.sep{
			align-self:stretch; display:flex; align-items:center; justify-content:center;
			font-weight:900; font-size: clamp(28px, 6vw, 42px); color:var(--accent); letter-spacing:.05em; padding:0 .1em;
		}
		/* 單面 Flip：平時只有 .face 可見；動畫時短暫顯示 .flip-layer 覆蓋層 */
		.flip{
			position:relative; width: clamp(64px, 16vw, 120px); perspective:1000px;
		}
		.face, .flip-layer{
			position:relative; background:#141821; color:#e9edf6; border-radius:10px;
			box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 12px 24px rgba(0,0,0,.35);
			overflow:hidden; text-align:center;
		}
		.value{
			font-family:var(--font); font-weight:800; font-variant-numeric:tabular-nums;
			font-size: clamp(36px, 10vw, 64px); line-height:1.05; padding:.45em .3em;
		}
		/* 中線裝飾（想要極簡可用 CSS 關掉） */
		.face::before, .flip-layer::before{
			content:""; position:absolute; left:0; right:0; top:50%; height:1px;
			background: rgba(255,255,255,.08); transform: translateY(-.5px);
		}
		/* 覆蓋層：預設不顯示，只有動畫時顯示 */
		.flip-layer{ position:absolute; inset:0; display:none; transform-style:preserve-3d; }
		/* meta 列 */
		.meta{
			display:flex; align-items:center; justify-content:space-between; color:var(--muted);
			font-family:var(--font); font-size: clamp(13px, 2.4vw, 16px); font-weight:600; letter-spacing:.04em;
		}
		.ampm{ text-transform:uppercase; color:var(--accent); }
	</style>
</head>
<body>
	<div class="widget">
		<div id="card" class="card">
			<div class="row">
				<div class="flip" id="H">
					<div class="face"><div class="value">00</div></div>
					<div class="flip-layer" aria-hidden="true"><div class="value">00</div></div>
				</div>
				<div class="sep">:</div>
				<div class="flip" id="M">
					<div class="face"><div class="value">00</div></div>
					<div class="flip-layer" aria-hidden="true"><div class="value">00</div></div>
				</div>
			</div>
			<div class="meta">
				<div id="date">----年--月--日</div>
				<div><span id="weekday">週–</span> <span id="ampm" class="ampm"></span></div>
			</div>
		</div>
	</div>

	<script>
	(function(){
		// 參數：?tz=Asia/Taipei&fmt=24&accent=%237c9cff&scale=1&border=1&locale=zh-TW&bg=transparent&shadow=0
		const params = new URLSearchParams(location.search);
		const tz = params.get('tz') || 'Asia/Taipei';
		const fmt24 = (params.get('fmt') || '24') === '24';
		const accent = params.get('accent');
		const scale = parseFloat(params.get('scale') || '1');
		const bordered = params.get('border') === '1';
		const locale = params.get('locale') || 'zh-TW';
		const bg = params.get('bg');          // 'transparent' | '#rrggbb' | 'auto' | 不帶
		const shadow = params.get('shadow');  // '0' 關閉陰影

		// 參數套用
		if (accent) document.documentElement.style.setProperty('--accent', accent);
		if (!isNaN(scale)) document.documentElement.style.setProperty('--scale', scale.toString());
		const card = document.getElementById('card');
		if (bordered) card.classList.add('bordered');
		if (bg === 'transparent'){
			card.style.background = 'transparent';
		}else if (bg && bg !== 'auto'){
			card.style.background = bg; // 例如 %23ffffff
		}
		if (shadow === '0'){
			card.style.boxShadow = 'none';
		}

		const pad2 = n => String(n).padStart(2,'0');
		const $ = s => document.querySelector(s);
		const H = $('#H'), M = $('#M');
		const dateEl = $('#date'), ampmEl = $('#ampm'), weekdayEl = $('#weekday');

		const weekdayMap = {0:'週日',1:'週一',2:'週二',3:'週三',4:'週四',5:'週五',6:'週六'};

		function getTimeParts(){
			const now = new Date();
			const parts = new Intl.DateTimeFormat('en-GB',{
				timeZone: tz, hour:'2-digit', minute:'2-digit', hour12:!fmt24
			}).formatToParts(now);
			const d = {}; for(const p of parts) d[p.type]=p.value;
			let hour = d.hour, minute = d.minute, ampm = fmt24 ? '' : (d.dayPeriod || '').toUpperCase();
			if (fmt24){
				hour = new Intl.DateTimeFormat('en-GB',{ timeZone: tz, hour:'2-digit', hour12:false }).format(now);
			}
			return { hour: pad2(hour), minute: pad2(minute), ampm, now };
		}

		function setMeta(now){
			dateEl.textContent = new Intl.DateTimeFormat(locale, {
				timeZone: tz, year:'numeric', month:'long', day:'numeric'
			}).format(now);
			const weekdayIndex = new Date(now.toLocaleString('en-US',{ timeZone: tz })).getDay();
			weekdayEl.textContent = weekdayMap[weekdayIndex];
		}

		// 單面翻頁：平時只有 .face，動畫用 .flip-layer 蓋上做一次旋轉
		function flipOnce(el, nextText){
			const faceVal = el.querySelector('.face .value');
			const current = faceVal.textContent.trim();
			if (current === nextText) return;

			const layer = el.querySelector('.flip-layer');
			const layerVal = layer.querySelector('.value');

			layerVal.textContent = nextText;
			layer.style.display = 'block';

			// Face 往後翻隱藏
			const a1 = faceVal.animate([
				{ transform:'rotateX(0deg)', filter:'brightness(1)' },
				{ transform:'rotateX(-90deg)', filter:'brightness(0.7)' }
			], { duration: 280, easing:'cubic-bezier(.25,.46,.45,.94)' });

			a1.onfinish = ()=>{
				faceVal.textContent = nextText;
				faceVal.style.transform = 'rotateX(0deg)';

				// 覆蓋層從 90deg 翻回 0deg，做為收合
				const a2 = layer.animate([
					{ transform:'rotateX(90deg)', filter:'brightness(0.7)' },
					{ transform:'rotateX(0deg)',  filter:'brightness(1)' }
				], { duration: 280, easing:'cubic-bezier(.25,.46,.45,.94)' });

				a2.onfinish = ()=>{
					layer.style.display = 'none';
				};
			};
		}

		let lastHM = '';
		function tick(){
			const { hour, minute, ampm, now } = getTimeParts();
			const hm = hour + minute;
			if (hm !== lastHM){
				flipOnce(H, hour);
				flipOnce(M, minute);
				lastHM = hm;
			}
			ampmEl.textContent = ampm;
			// 每 5 分鐘刷新一次日期與星期
			if (minute.endsWith('0') || minute.endsWith('5')) setMeta(now);
		}

		// 初始
		const t0 = getTimeParts();
		H.querySelector('.face .value').textContent = t0.hour;
		M.querySelector('.face .value').textContent = t0.minute;
		ampmEl.textContent = t0.ampm;
		setMeta(t0.now);

		// 對齊下一秒開始
		function start(){ const ms = 1000 - (new Date().getMilliseconds()); setTimeout(()=>{ tick(); setInterval(tick, 1000); }, ms); }
		start();

		// 小寬度自適應
		function fit(){
			const w = window.innerWidth;
			if (w < 340) document.documentElement.style.setProperty('--scale', (w/340).toFixed(3));
		}
		window.addEventListener('resize', fit, { passive:true });
	})();
	</script>
</body>
</html>
